{% extends "base.html" %}

{% block content %}
<div class="page-section">
  <h2>Forecast Dashboard</h2>
  <div class="forecast-toolbar" style="display:flex; justify-content: space-between; align-items:center; margin-bottom: 8px;">
    <div>
      <button id="btn-forecast-refresh" class="btn btn-primary btn-sm">
        Sync Forecast Data
      </button>
    </div>
    <div id="forecast-refresh-status" style="font-size: 12px; color: #666;"></div>
  </div>

  <div id="forecast-debug" style="display:none; font-size: 11px; color: #666; margin-bottom: 6px;"></div>

  <div id="forecast-source-status" class="forecast-source-status-strip" style="margin-bottom: 12px; display:none;"></div>

      <div id="forecast-meta-banner" class="forecast-meta-banner"></div>
      <div class="forecast-sort-controls" style="margin-bottom:8px; font-size:13px; display:none;">
        <label style="margin-right:6px;">Sort by:</label>
        <select id="forecast-sort-key" style="margin-right:6px;">
          <option value="p70Demand" selected>P70 Demand (Horizon)</option>
          <option value="last30dUnits">Last 30d Units</option>
          <option value="weeksOfCover">Cover (wks @ P70)</option>
          <option value="currentInventory">Current Inv</option>
          <option value="avgWeeklyUnits">Avg Weekly</option>
          <option value="next30dInbound">Next 30d Inbound</option>
        </select>
        <select id="forecast-sort-dir">
          <option value="desc" selected>Desc</option>
          <option value="asc">Asc</option>
        </select>
      </div>

  <div class="forecast-table-wrapper">
    <table class="table" id="forecast-table">
      <thead>
        <tr>
          <th>ASIN</th>
          <th class="sortable" data-sort="currentInventory">Current Inv</th>
          <th class="sortable" data-sort="last30dUnits">Last 30d Units</th>
          <th class="sortable" data-sort="avgWeeklyUnits">Avg Weekly</th>
          <th class="sortable" data-sort="next30dInbound">Next 30d Inbound</th>
          <th class="sortable" data-sort="p70Demand">P70 Demand (Horizon)</th>
          <th class="sortable" data-sort="weeksOfCover">Cover (wks @ P70)</th>
          <th>Risk</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="forecast-table-body"></tbody>
    </table>
  </div>
</div>

<style>
  .forecast-source-status-strip {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }
  .forecast-status-card {
    border: 1px solid #ddd;
    border-radius: 6px;
    padding: 0.5rem 0.75rem;
    font-size: 0.85rem;
    background-color: #fff;
  }
  .forecast-meta-banner {
    margin-bottom: 0.75rem;
    font-size: 0.85rem;
    color: #555;
  }
</style>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="/static/js/forecast.js"></script>
{% endblock %}
